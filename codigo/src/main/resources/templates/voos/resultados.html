<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados - Carbon Flight</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fugaz+One&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/forms.css}">
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="container">
                <div class="navbar-brand">
                    <a href="/"><h1>Carbon Flight</h1></a>
                </div>
                <ul class="navbar-menu">
                    <li><a href="/">In√≠cio</a></li>
                    <li><a href="/voos/buscar" class="active">Buscar Voos</a></li>
                    <li><a href="/sobre">Sobre</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main>
        <section class="results-section">
            <div class="container">
                <!-- Bot√£o de Voltar -->
                <div class="back-button-container">
                    <a href="/voos/buscar" class="back-button">
                        <span class="back-arrow">‚Üê</span>
                        <span class="back-text">Voltar</span>
                    </a>
                </div>
                
                <!-- Cabe√ßalho de Resultados -->
                <div class="results-header">
                    <h2>‚úàÔ∏è Voos Encontrados</h2>
                    <p>Ordenados por menor emiss√£o de carbono</p>
                    <div class="results-info">
                        <div class="result-stat">
                            <span class="number" th:text="${#lists.size(voos)}">0</span>
                            <span class="label">voos encontrados</span>
                        </div>
                        <div class="result-stat">
                            <span class="number" th:text="${origem}">GRU</span>
                            <span class="label">origem</span>
                        </div>
                        <div class="result-stat">
                            <span class="number">‚Üí</span>
                        </div>
                        <div class="result-stat">
                            <span class="number" th:text="${destino}">JFK</span>
                            <span class="label">destino</span>
                        </div>
                        <div class="result-stat">
                            <span class="number" th:text="${data}">2025-01-20</span>
                            <span class="label">data</span>
                        </div>
                    </div>
                </div>

                <!-- Lista de Voos -->
                <div class="flights-grid" th:if="${voos != null and !voos.isEmpty()}">
                    <div class="flight-card" th:each="voo, iterStat : ${voos}">
                        <div class="flight-header">
                            <div class="flight-route">
                                <span th:text="${voo.origem}">GRU</span>
                                <span> ‚úàÔ∏è </span>
                                <span th:text="${voo.destino}">JFK</span>
                            </div>
                            <div class="flight-emission">
                                <span th:text="${#numbers.formatDecimal(voo.emissaoCarbono, 1, 2)}">123.45</span> kg CO‚ÇÇ
                            </div>
                        </div>

                        <div class="flight-details">
                            <div class="detail-item">
                                <span class="detail-label">üõ´ Partida</span>
                                <span class="detail-value" th:text="${voo.dataPartida}">2025-01-20 10:30</span>
                            </div>

                            <div class="detail-item">
                                <span class="detail-label">üõ¨ Chegada</span>
                                <span class="detail-value" th:text="${voo.dataChegada}">2025-01-20 22:45</span>
                            </div>

                            <div class="detail-item">
                                <span class="detail-label">‚è±Ô∏è Dura√ß√£o</span>
                                <span class="detail-value" th:text="${voo.duracao}">12h 15min</span>
                            </div>

                            <div class="detail-item">
                                <span class="detail-label">üîÑ Escalas</span>
                                <span class="detail-value" th:text="${voo.numeroConexoes == 0 ? 'Direto' : voo.numeroConexoes + ' escala(s)'}">Direto</span>
                            </div>

                            <div class="detail-item">
                                <span class="detail-label">‚úàÔ∏è Companhia</span>
                                <span class="detail-value" th:text="${voo.companhia}">LATAM</span>
                            </div>

                            <div class="detail-item">
                                <span class="detail-label">üí∞ Pre√ßo</span>
                                <span class="detail-value" th:text="${voo.precoMoeda + ' ' + #numbers.formatDecimal(voo.precoValor, 1, 2)}">BRL 1.234,56</span>
                            </div>
                        </div>

                        <!-- Badge de Classifica√ß√£o de Emiss√£o -->
                        <div>
                            <span class="emission-badge" 
                                  th:classappend="${voo.emissaoCarbono < 100 ? 'emission-low' : (voo.emissaoCarbono < 200 ? 'emission-medium' : 'emission-high')}">
                                <span th:if="${voo.emissaoCarbono < 100}">üå± Emiss√£o Baixa</span>
                                <span th:if="${voo.emissaoCarbono >= 100 and voo.emissaoCarbono < 200}">‚ö†Ô∏è Emiss√£o M√©dia</span>
                                <span th:if="${voo.emissaoCarbono >= 200}">üî¥ Emiss√£o Alta</span>
                            </span>
                        </div>

                        <!-- Detalhes da Rota (se houver conex√µes) -->
                        <div th:if="${voo.numeroConexoes > 0}" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #f0f0f0;">
                            <span class="detail-label" style="display: block; margin-bottom: 8px;">üó∫Ô∏è Rota Completa:</span>
                            <span class="detail-value" th:text="${voo.rota}">GRU ‚Üí CDG ‚Üí JFK</span>
                        </div>
                    </div>
                </div>

                <!-- Mensagem quando n√£o h√° voos -->
                <div class="empty-state" th:if="${voos == null or voos.isEmpty()}">
                    <div class="error-icon">üòû</div>
                    <h3>Nenhum voo encontrado</h3>
                    <p>N√£o encontramos voos dispon√≠veis para sua busca.</p>
                    <p>Tente alterar os par√¢metros de busca ou escolher outra data.</p>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 Carbon Flight - Sistema de Voos Sustent√°veis</p>
        </div>
    </footer>

    <script th:src="@{/js/airports.js?v=2}"></script>
    <script th:inline="javascript">
        // Converte c√≥digos IATA para "Cidade (IATA)" no cabe√ßalho de resultados
        document.addEventListener('DOMContentLoaded', function() {
            const origemElement = document.querySelector('.results-info .result-stat:nth-child(2) .number');
            const destinoElement = document.querySelector('.results-info .result-stat:nth-child(4) .number');
            
            if (origemElement && destinoElement && typeof airports !== 'undefined') {
                const origemCode = origemElement.textContent.trim();
                const destinoCode = destinoElement.textContent.trim();
                
                const origemAirport = airports.find(a => a.iata === origemCode);
                const destinoAirport = airports.find(a => a.iata === destinoCode);
                
                if (origemAirport) {
                    origemElement.textContent = `${origemAirport.city} (${origemCode})`;
                }
                
                if (destinoAirport) {
                    destinoElement.textContent = `${destinoAirport.city} (${destinoCode})`;
                }
            }
        });
    </script>
</body>
</html>